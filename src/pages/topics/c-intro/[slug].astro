---
import Layout from '@layouts/Layout.astro';
import PracticePane from '@components/PracticePane.jsx';

const { slug } = Astro.params;
if (slug === undefined) {
    throw new Error('Slug should always be present!');
}

const matches = await import.meta.glob('/src/content/c-intro/*.mdx', {
    eager: true,
});

const lesson = matches[`/src/content/c-intro/${slug}.mdx`];
if (lesson === undefined) {
    return Astro.redirect('/topics/c-intro/');
}

const Content = lesson?.Content;

const ex = lesson.exercises;

const condition = ex?.at(0).condition ?? '';

const includeCode: string | undefined = ex?.at(0).include_code?.trim();
const initialCode: string = ex?.at(0).init_code?.trim() ?? '';
if (ex != undefined && initialCode === '') {
    throw Error(
        'Exercise given with no initial code. Leave at least a comment!',
    );
}
---

<Layout title="Welcome to Astro.">
    <!-- TODO: Implement Header -->

    <div class="container">
        <div>
            <a href="/topics/">Topics</a> /
            <a href="/topics/c-intro/">C Introduction</a> /
            <span>{lesson.frontmatter.title}</span>
        </div>

        <h1>{lesson.frontmatter.title}</h1>

        <div class="split">
            <div class:list={[{ half: ex === undefined }]}>
                <Content />
            </div>

            {
                ex && (
                    <div class="editor">
                        <div>{condition}</div>

                        <PracticePane
                            client:load
                            check={true}
                            exId={`c-intro/${slug}`}
                            initialCode={initialCode}
                        />
                    </div>
                )
            }
        </div>
    </div>

    <!-- TODO: Implement Footer -->
</Layout>

<style>
    .container {
        padding: 0 2rem;
    }

    .split {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    .half {
        width: 50%;
    }

    @media only screen and (min-width: 1200px) {
        .half {
            width: 100%;
        }
        .split {
            flex-direction: row;
        }
    }

    .editor {
        white-space: pre-wrap;
    }
</style>

<style is:global>
    pre {
        padding: 0.5rem;
    }

    .out {
        font-family: monospace;
    }

    .codearea {
        font-family: monospace !important;
        font-size: 1rem !important;

        border: 1px solid black !important;
        border-radius: 0.3rem;
    }
</style>
